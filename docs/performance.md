# Производительность

Из-за специфики, сложившейся вокруг OpenCart и его довольно… своеобразного позиционирования, инфраструктура, на которой работают магазины, бывает абсолютно непредсказуемой. Реальные магазины, которые, казалось бы, должны приносить прибыль и работать надёжно, владельцы умудряются размещать на виртуальных хостингах за 300 рублей. Конечно, это выбор владельца, но лично я такие решения не принимаю и, скажем так, не одобряю.

При разработке модуля TeleCart, выбрав в качестве основы OpenCart, я прекрасно понимал, на что подписываюсь. Разработка велась на устаревшей версии PHP (7.4), на устаревшей MySQL, и с архитектурой, которая давно просится на переписывание. Приходилось искать компромиссы и решать нетривиальные задачи, чтобы в это OpenCart-безумие встроить что-то современное, стабильное, производительное и ещё желательно безопасное.

Тем не менее, я считаю, что справился. Telegram-магазин работает внутри OpenCart без плясок с бубнами, без сложных настроек сервера и без необходимости перепиливать систему. Более того — базовая работоспособность TeleCart гарантирована без каких-либо дополнительных модификаций.

Но у любой системы есть пределы. Чем больше товаров, чем больше изображений и запросов, тем сильнее начинают проявляться архитектурные слабости OpenCart. Соответственно, тем больше ресурсов требуется, чтобы поддерживать работу магазина хотя бы на приемлемом уровне.

TeleCart базируется на OpenCart, и как бы я ни оптимизировал, рано или поздно при относительно больших объёмах данных (1000+ товаров) производительность Telegram-магазина начнёт проседать. Однако внутри TeleCart сделано всё возможное, чтобы этот момент максимально оттянуть и выжать из OpenCart всё, что он вообще способен дать.

На сегодняшний день TeleCart улучшает производительность следующими способами:

- Кэширование критичных участков. Снижает нагрузку на сервер, базу данных и избавляет систему от выполнения одних и тех же вычислений для каждого пользователя.
- Сжатие изображений. TeleCart полностью работает в формате *.webp. Это резко уменьшает размер файлов и уменьшает нагрузку на сеть и диск.
- Оптимизированные SQL-запросы. Многие запросы были переписаны вручную, чтобы сделать их максимально эффективными в рамках архитектуры OpenCart.
- Фоновые процессы. TeleCart автоматически очищает устаревшие файлы, кеш и выполняет ряд служебных задач. В базовой конфигурации даже не требуется CRON — всё работает само.

Разумеется, это сделано в рамках ограничений OpenCart. Поле для улучшений куда шире, если у вас нормальная инфраструктура: мощный VPS, правильно настроенная MySQL, адекватный веб-сервер и отсутствие «хостинг-экстрима».

На продвинутых серверах я рекомендую настроить CRON, использовать in-memory-хранилище (например, Redis) и нормальный веб-сервер (nginx или Caddy). Так же требуется понимание работы MySQL и навешивание правильных индексов на таблицы. В таком случае я могу помочь вашему разработчику довести TeleCart до состояния, когда он работает на максимальной скорости вашей инфраструктуры.

Отдельно стоит сказать про оптимизацию изображений. В TeleCart она происходит на лету — прямо в момент, когда пользователь запрашивает товар. Это очень удобно, но есть нюанс: если кэш изображений ещё не прогрет, серверу приходится выполнять тяжёлую работу по сжатию и генерации webp прямо в реальном времени. На слабых хостингах это может чувствоваться, особенно при большом количестве товаров или первых масcовых заходах пользователей.

Чтобы смягчить эту проблему, я написал отдельную утилиту для предварительного прогрева кэша изображений. Она проходит по всем товарам, генерирует webp заранее и тем самым снимает нагрузку с магазина при реальных пользовательских запросах. Это позволяет получить максимальную производительность от TeleCart — но есть одно условие: утилиту нужно запускать. А для этого требуется нормальный VPS, SSH-доступ и минимально рабочая инфраструктура, а не «хостинг мечты за 300 рублей».

Если у вас хорошие серверные ресурсы, я могу помочь настроить прогрев изображений, оптимизировать окружение и выжать всё возможное из TeleCart и вашего OpenCart. Обращайтесь — оптимизирую настолько, насколько позволяет ваш хостинг.
